<!DOCTYPE html>
<html lang="pt-BR">
<head>
// =================================================================
// versão 4
 // =================================================================
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo de Conteúdo</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml/dist/js-yaml.min.js"></script>
    
    <style>
        /* Todo o seu CSS vai aqui... (o mesmo da versão anterior) */
        body { font-family: sans-serif; /* ... */ }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="loading">Carregando conteúdo...</div>
        <div id="error" style="display: none;"></div>
        <div id="content-wrapper" style="display: none;"></div>
    </div>

    <div id="theme-switcher">
        </div>

    <script>
        console.log('[DEBUG] Script principal iniciado.');

        // =================================================================
        // LÓGICA DO SELETOR DE TEMAS E CORES (sem alterações)
        // =================================================================
        const themeButton = document.getElementById('theme-button');
        // ... (resto do código do seletor de temas) ...
        const savedTheme = localStorage.getItem('selectedTheme') || 'light';
        const savedPalette = localStorage.getItem('selectedPalette') || 'default';
        // ... (código de aplicação de tema) ...

        // =================================================================
        // LÓGICA DE CARREGAMENTO DO CONTEÚDO DO MÓDULO (COM DEBUG)
        // =================================================================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('[DEBUG] Evento DOMContentLoaded disparado. A página HTML está pronta.');
            try {
                console.log('[DEBUG] Entrando no bloco try...catch para buscar o conteúdo.');
                const urlParams = new URLSearchParams(window.location.search);
                const srcPath = urlParams.get('src');
                
                console.log('[DEBUG] 1. Caminho extraído do parâmetro "src" da URL:', `"${srcPath}"`);


                if (!srcPath) {
                    throw new Error('Nenhum arquivo de conteúdo (src) foi especificado na URL.');
                }
                
                // --- LÓGICA DE CAMINHO ROBUSTA COM DEBUG ---
                const currentPagePath = window.location.pathname;
                console.log('[DEBUG] 2. Caminho da página atual (window.location.pathname):', `"${currentPagePath}"`);

                const baseDir = currentPagePath.substring(0, currentPagePath.lastIndexOf('/') + 1);
                console.log('[DEBUG] 3. Diretório base calculado (deve ser /pagecurso1/):', `"${baseDir}"`);

                const fullPath = baseDir + srcPath;
                console.log('[DEBUG] 4. Caminho FINAL e COMPLETO que será buscado:', `"${fullPath}"`);
                // --- FIM DA LÓGICA DE CAMINHO ---

                console.log('[DEBUG] 5. Executando o fetch()...');
                const response = await fetch(fullPath);
                
                console.log('[DEBUG] 6. Resposta do fetch recebida. Status:', response.status, response.statusText);


                if (!response.ok) {
                    // O erro 404 será capturado aqui
                    throw new Error(`[${response.status}] Não foi possível encontrar o arquivo no caminho: ${fullPath}`);
                }

                console.log('[DEBUG] 7. Sucesso! O arquivo foi encontrado. Lendo o conteúdo...');
                const markdownContent = await response.text();
                
                // ... (o resto do código para processar o markdown continua aqui)
                
                const frontMatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
                const match = markdownContent.match(frontMatterRegex);
                const metadata = match ? jsyaml.load(match[1]) : {};
                const content = match ? match[2] : markdownContent;
                
                document.title = metadata.title || 'Módulo de Conteúdo';
                const contentHtml = marked.parse(content);
                
                const moduleHtml = `
                    <div class="module-header">
                        <h1>${metadata.title || ''}</h1>
                        <p>${metadata.description || ''}</p>
                    </div>
                    <div class="content-section">${contentHtml}</div>
                `;
                
                document.getElementById('content-wrapper').innerHTML = moduleHtml;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content-wrapper').style.display = 'block';
                console.log('[DEBUG] 8. Módulo renderizado na tela com sucesso!');


            } catch (error) {
                console.error('[DEBUG] Ocorreu um erro dentro do bloco catch.');
                console.error('[DEBUG] Objeto do erro:', error);

                const loadingDiv = document.getElementById('loading');
                const errorDiv = document.getElementById('error');
                loadingDiv.style.display = 'none';
                errorDiv.textContent = `❌ Erro ao carregar o módulo: ${error.message}`;
                errorDiv.style.display = 'block';
            }
        });
    </script>
</body>
</html>
